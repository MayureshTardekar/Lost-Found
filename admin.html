<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <script src="theme.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Lost & Found</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#7c3aed",
                        "background-light": "#ffffff",
                        "background-dark": "#05060a",
                    },
                },
            },
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, rgba(168, 85, 247, 0.05) 100%);
            border: 1px solid rgba(124, 58, 237, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(124, 58, 237, 0.3);
        }
        
        .tab-btn {
            transition: all 0.2s ease;
        }
        
        .tab-btn.active {
            background: #7c3aed;
            color: white;
        }
    </style>
</head>
<body class="h-full">

<!-- Header -->
<header class="sticky top-0 z-10 bg-black/50 backdrop-blur-md border-b border-gray-800">
    <div class="flex items-center justify-between px-6 py-4 max-w-7xl mx-auto">
        <div class="flex items-center gap-2">
            <span class="material-symbols-outlined text-purple-500 text-3xl">admin_panel_settings</span>
            <h1 class="text-xl font-bold text-purple-500">Admin Dashboard</h1>
        </div>
        
        <div class="flex-grow"></div>
        
        <div class="flex items-center gap-3">
            <!-- Theme Toggle -->
            <button id="themeToggle" class="flex items-center justify-center w-10 h-10 hover:bg-gray-800 rounded-full transition" title="Toggle Theme">
                <span class="material-symbols-outlined text-gray-400" id="themeIcon">dark_mode</span>
            </button>
            <a href="index.html" class="px-4 py-2 bg-gray-800 text-gray-300 rounded-lg hover:bg-gray-700 transition">
                <span class="material-symbols-outlined text-sm">arrow_back</span>
                Back to Browse
            </a>
        </div>
    </div>
</header>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 py-8">
    <!-- Stats Grid -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="stat-card p-6 rounded-xl text-center">
            <div class="text-4xl font-bold text-purple-400 mb-2" id="statUsers">0</div>
            <div class="text-sm text-gray-400">Total Users</div>
        </div>
        
        <div class="stat-card p-6 rounded-xl text-center">
            <div class="text-4xl font-bold text-blue-400 mb-2" id="statItems">0</div>
            <div class="text-sm text-gray-400">Total Items</div>
        </div>
        
        <div class="stat-card p-6 rounded-xl text-center">
            <div class="text-4xl font-bold text-yellow-400 mb-2" id="statPending">0</div>
            <div class="text-sm text-gray-400">Pending Claims</div>
        </div>
        
        <div class="stat-card p-6 rounded-xl text-center">
            <div class="text-4xl font-bold text-green-400 mb-2" id="statResolved">0</div>
            <div class="text-sm text-gray-400">Resolved Items</div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
        <button onclick="switchTab('items')" id="tab-items" class="tab-btn active px-6 py-3 rounded-lg bg-gray-800 text-gray-300 whitespace-nowrap">
            ðŸ“¦ All Items
        </button>
        <button onclick="switchTab('claims')" id="tab-claims" class="tab-btn px-6 py-3 rounded-lg bg-gray-800 text-gray-300 whitespace-nowrap">
            ðŸŽ¯ All Claims
        </button>
        <button onclick="switchTab('users')" id="tab-users" class="tab-btn px-6 py-3 rounded-lg bg-gray-800 text-gray-300 whitespace-nowrap">
            ðŸ‘¥ All Users
        </button>
    </div>

    <!-- Tab Content -->
    <div class="bg-gray-900/80 backdrop-blur-sm p-6 rounded-2xl border border-gray-800">
        <!-- Items Tab -->
        <div id="content-items" class="tab-content">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-white">All Items</h2>
                <input type="text" id="searchItems" placeholder="Search items..." class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-purple-500 focus:outline-none">
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm" id="itemsTable">
                    <thead class="text-xs uppercase bg-gray-800 text-gray-400">
                        <tr>
                            <th class="px-4 py-3">Title</th>
                            <th class="px-4 py-3">Type</th>
                            <th class="px-4 py-3">Status</th>
                            <th class="px-4 py-3">Owner</th>
                            <th class="px-4 py-3">Location</th>
                            <th class="px-4 py-3">Date</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-300" id="itemsTableBody">
                        <tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Claims Tab -->
        <div id="content-claims" class="tab-content hidden">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-white">All Claims</h2>
                <input type="text" id="searchClaims" placeholder="Search claims..." class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-purple-500 focus:outline-none">
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm" id="claimsTable">
                    <thead class="text-xs uppercase bg-gray-800 text-gray-400">
                        <tr>
                            <th class="px-4 py-3">Item</th>
                            <th class="px-4 py-3">Claimant</th>
                            <th class="px-4 py-3">Owner</th>
                            <th class="px-4 py-3">Status</th>
                            <th class="px-4 py-3">Date</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-300" id="claimsTableBody">
                        <tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="content-users" class="tab-content hidden">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-white">All Users</h2>
                <input type="text" id="searchUsers" placeholder="Search users..." class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-purple-500 focus:outline-none">
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm" id="usersTable">
                    <thead class="text-xs uppercase bg-gray-800 text-gray-400">
                        <tr>
                            <th class="px-4 py-3">Name</th>
                            <th class="px-4 py-3">UCID</th>
                            <th class="px-4 py-3">Email</th>
                            <th class="px-4 py-3">Role</th>
                            <th class="px-4 py-3">Department</th>
                            <th class="px-4 py-3">Status</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-300" id="usersTableBody">
                        <tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<footer class="bg-gray-100 dark:bg-gray-900/50 border-t border-gray-300 dark:border-gray-800 mt-16">
    <div class="max-w-7xl mx-auto px-4 py-6 text-center">
        <p class="text-sm text-gray-600 dark:text-gray-500">Â© 2025 SPIT Lost & Found - Admin Dashboard</p>
    </div>
</footer>

<script src="auth.js"></script>
<script>
// Check if user is admin
document.addEventListener('DOMContentLoaded', async () => {
    const currentUser = JSON.parse(localStorage.getItem('campus_lost_found_current_user'));
    
    if (!currentUser) {
        alert('Please login first');
        window.location.href = 'login.html';
        return;
    }
    
    if (currentUser.role !== 'admin') {
        alert('Access denied. Admin only.');
        window.location.href = 'index.html';
        return;
    }
    
    // Load stats
    await loadStats();
    
    // Load items by default
    await loadItems();
    
    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    
    if (themeToggle && themeIcon) {
        // Set initial icon
        const isDark = document.documentElement.classList.contains('dark');
        themeIcon.textContent = isDark ? 'light_mode' : 'dark_mode';
        
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.contains('dark');
            
            if (isDark) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('campus_lost_found_theme', 'light');
                themeIcon.textContent = 'dark_mode';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('campus_lost_found_theme', 'dark');
                themeIcon.textContent = 'light_mode';
            }
        });
    }
});

async function loadStats() {
    try {
        const response = await fetch('/api/admin/stats');
        const stats = await response.json();
        
        document.getElementById('statUsers').textContent = stats.users || 0;
        document.getElementById('statItems').textContent = stats.items || 0;
        document.getElementById('statPending').textContent = stats.pendingClaims || 0;
        document.getElementById('statResolved').textContent = stats.resolvedItems || 0;
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

function switchTab(tab) {
    // Update tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`tab-${tab}`).classList.add('active');
    
    // Update content
    document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
    document.getElementById(`content-${tab}`).classList.remove('hidden');
    
    // Load data
    if (tab === 'items') loadItems();
    else if (tab === 'claims') loadClaims();
    else if (tab === 'users') loadUsers();
}

async function loadItems() {
    try {
        const response = await fetch('/api/admin/items');
        const items = await response.json();
        
        const tbody = document.getElementById('itemsTableBody');
        
        if (items.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">No items found</td></tr>';
            return;
        }
        
        tbody.innerHTML = items.map(item => {
            const typeColors = {
                'Lost': 'text-red-400 bg-red-400/10',
                'Found': 'text-green-400 bg-green-400/10'
            };
            
            const statusColors = {
                'Open': 'text-yellow-400 bg-yellow-400/10',
                'Resolved': 'text-green-400 bg-green-400/10',
                'Closed': 'text-gray-400 bg-gray-400/10'
            };
            
            return `
                <tr class="border-b border-gray-800 hover:bg-gray-800/50">
                    <td class="px-4 py-3 font-medium text-white">${item.title}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 text-xs rounded-full ${typeColors[item.type]}">${item.type}</span></td>
                    <td class="px-4 py-3"><span class="px-2 py-1 text-xs rounded-full ${statusColors[item.status]}">${item.status}</span></td>
                    <td class="px-4 py-3">${item.user_name}</td>
                    <td class="px-4 py-3">${item.location_text || item.location_name || 'N/A'}</td>
                    <td class="px-4 py-3">${new Date(item.created_at).toLocaleDateString()}</td>
                </tr>
            `;
        }).join('');
        
        // Add search functionality
        document.getElementById('searchItems').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    } catch (error) {
        console.error('Error loading items:', error);
    }
}

async function loadClaims() {
    try {
        const response = await fetch('/api/admin/claims');
        const claims = await response.json();
        
        const tbody = document.getElementById('claimsTableBody');
        
        if (claims.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">No claims found</td></tr>';
            return;
        }
        
        tbody.innerHTML = claims.map(claim => {
            const statusColors = {
                'Pending': 'text-yellow-400 bg-yellow-400/10',
                'Approved': 'text-green-400 bg-green-400/10',
                'Rejected': 'text-red-400 bg-red-400/10'
            };
            
            return `
                <tr class="border-b border-gray-800 hover:bg-gray-800/50">
                    <td class="px-4 py-3 font-medium text-white">${claim.item_title}</td>
                    <td class="px-4 py-3">${claim.claimant_name}</td>
                    <td class="px-4 py-3">${claim.item_owner_name}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 text-xs rounded-full ${statusColors[claim.status]}">${claim.status}</span></td>
                    <td class="px-4 py-3">${new Date(claim.created_at).toLocaleDateString()}</td>
                </tr>
            `;
        }).join('');
        
        // Add search functionality
        document.getElementById('searchClaims').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    } catch (error) {
        console.error('Error loading claims:', error);
    }
}

async function loadUsers() {
    try {
        const response = await fetch('/api/admin/users');
        const users = await response.json();
        
        const tbody = document.getElementById('usersTableBody');
        
        if (users.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">No users found</td></tr>';
            return;
        }
        
        tbody.innerHTML = users.map(user => {
            const roleColors = {
                'admin': 'text-purple-400 bg-purple-400/10',
                'staff': 'text-blue-400 bg-blue-400/10',
                'student': 'text-gray-400 bg-gray-400/10'
            };
            
            return `
                <tr class="border-b border-gray-800 hover:bg-gray-800/50">
                    <td class="px-4 py-3 font-medium text-white">${user.name}</td>
                    <td class="px-4 py-3">${user.ucid}</td>
                    <td class="px-4 py-3">${user.email}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 text-xs rounded-full ${roleColors[user.role]}">${user.role}</span></td>
                    <td class="px-4 py-3">${user.department || 'N/A'}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 text-xs rounded-full ${user.is_active ? 'text-green-400 bg-green-400/10' : 'text-red-400 bg-red-400/10'}">${user.is_active ? 'Active' : 'Inactive'}</span></td>
                </tr>
            `;
        }).join('');
        
        // Add search functionality
        document.getElementById('searchUsers').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    } catch (error) {
        console.error('Error loading users:', error);
    }
}
</script>

</body>
</html>

